#!/bin/bash

if [[ "$DEBUG" = "yes" ]]; then
  set -x
fi

readonly DOTFILES_DIR=~/.dotfiles
cd $DOTFILES_DIR

function usage() {
cat <<_EOT_
usage: dotfile <command>

available commands are:
   commit   Record changes to the repository.
   push     Update remote refs along with associated objects
   status   Show the working tree status
_EOT_
}

function git_status_count() { git status -s | wc -l; }
function git_status_file_name() { git status -s | awk '{print $2}'; }

function main() {
  if [[ $# -ne 1 ]]; then
    usage
    exit 1
  fi

  case $1 in
    commit)
      case git_status_count in
        0)
          echo "nothing to commit, working directory clean"
          exit 1;
          ;;
        1)
          git add -A
          git commit -m "Update ${git_status_file_name}"
          ;;
        *)
          git add -A
          git commit -m "Update dotfiles"
      esac
      ;;
    push)
      git push origin master
      ;;
    status)
      git status
      ;;
    help)
      usage
      exit 0
      ;;
    *)
      usage
      exit 1
  esac
}

main "$@"
