#!/usr/bin/env bash
set -e

if type git; then
  : # You have git command. No Problem
else
  echo "Please install git command!"
  exit 1;
fi

if [ ! -n "$DOTFILES_DIR" ]; then
  DOTFILES_DIR="${HOME}/.dotfiles"
fi

echo ""
echo "Start fetch dotfiles..."

if [ ! -d "${DOTFILES_DIR}" ]; then
  mkdir -p "${DOTFILES_DIR}"
  git clone git@github.com:ryog/dotfiles.git "${DOTFILES_DIR}"
else
  echo "${DOTFILES_DIR} already exists!"
fi

echo "Done."
echo ""
echo "Start symbolic link dotfiles..."

[ ! -d "${HOME}/.config" ] && mkdir -p "${HOME}/config"
[ ! -d "${HOME}/.vim" ] && mkdir -p "${HOME}/.vim"

file_names=(
  # bash_aliases
  # bash_profile
  # bashrc
  ctags
  curlrc
  gemrc
  gitconfig
  gitignore
  railsrc
  rubocop.yml
  tmux.conf
  vimrc
  vim/init.vim
  vim/ftplugin
  vim/rc
  zshenv
  zshrc
)

for file_name in ${file_names[@]}; do
  ln -fnsv "${DOTFILES_DIR}/${file_name}" "${HOME}/.${file_name}"
done

ln -fnsv "${HOME}/.vim/" "${HOME}/.config/nvim"

if [ -d "/usr/local/etc/bash_completion.d/" ]; then
  ln -fnsv "${DOTFILES_DIR}/completions/dotfile-completion.bash" "/usr/local/etc/bash_completion.d/dotfile-completion.bash"
fi

if [ -d "/usr/local/share/zsh-completions" ]; then
  ln -fnsv "${DOTFILES_DIR}/completions/dotfile-completion.zsh" "/usr/local/share/zsh-completions/_dotfile"
fi

echo "Done."
echo ""
echo "Start install NeoBundle"

if [ ! -d "${HOME}/.vim/bundle/neobundle.vim" ]; then
  curl https://raw.githubusercontent.com/Shougo/neobundle.vim/master/bin/install.sh | sh
else
  echo "${HOME}/.vim/bundle/neobundle.vim already exists!"
fi

echo "Done."
echo ""
echo "Complete setup dotfiles!"
