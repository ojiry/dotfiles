#!/usr/bin/env bash
set -e

if type git; then
  : # You have git command. No Problem
else
  echo "Please install git command!"
  exit 1;
fi

if [ ! -n "$DOTFILES_DIR" ]; then
  DOTFILES_DIR="${HOME}/.dotfiles"
fi

echo ""
echo "Start fetch dotfiles..."

if [ ! -d "${DOTFILES_DIR}" ]; then
  mkdir -p "${DOTFILES_DIR}"
  git clone git@github.com:ryog/dotfiles.git "${DOTFILES_DIR}"
else
  echo "TODO: Add comment"
fi

echo "Done."
echo ""
echo "Start symbolic link dotfiles..."

[ ! -d "${HOME}/.config" ] && mkdir -p "${HOME}/config"
[ ! -d "${HOME}/.vim" ] && mkdir -p "${HOME}/.vim"
[ ! -d "${HOME}/.vim/rc" ] && mkdir -p "${HOME}/.vim/rc"

file_names=(
  bash_aliases
  bash_profile
  bashrc
  ctags
  gemrc
  gitconfig
  gitignore
  railsrc
  rubocop.yml
  tmux.conf
  vimrc
  vim/init.vim
  vim/rc/neobundle.toml
  vim/rc/neobundlelazy.toml
  vim/rc/plugins
  vim/rc/plugins.rc.vim
  vim/rc/vimrc
)

for file_name in ${file_names[@]}; do
  ln -vsf "${DOTFILES_DIR}/${file_name}" "${HOME}/.${file_name}"
done

ln -vsf "${HOME}/.vim" "${HOME}/.config/nvim"

if [ -d "/usr/local/etc/bash_completion.d/" ]; then
  ln -vsf "${DOTFILES_DIR}/completions/dotfile-completion.bash" "/usr/local/etc/bash_completion.d/dotfile-completion.bash"
fi

echo "Done."
echo ""
echo "Start install NeoBundle"

if [ ! -d "${HOME}/.vim/bundle/neobundle.vim" ]; then
  curl https://raw.githubusercontent.com/Shougo/neobundle.vim/master/bin/install.sh | sh
else
  echo "TODO: Add comment"
fi

echo "Done."
echo ""
echo "Complete setup dotfiles!"
